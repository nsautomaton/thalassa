<html>
<title>thalassa</title>
<head>
<meta charset='utf-8'>
<link href="stylesheets/styles.css" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]> 
  <script> document.createElement("curly");
  </script>
  <![endif]-->
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js" ></script>
  <script>
  $(document).ready(function(){
    $("code, .code").each(function(){ 
	  that = $(this);
	  var arr = $(this).html().split('"');
	  var i = 0;
	    $.each(arr, function(index, value) {
		  if(index != i)
		  {
          that.html(that.html().replace(value, '<quoted>' + value + '</quoted>'));
		  }else{
		    i += 2;
			}
        });
	  var arr = $(this).html().split("'");
	  var i = 0;
	    $.each(arr, function(index, value) {
		  if(index != i)
		  {
          that.html(that.html().replace(value, '<quoted>' + value + '</quoted>'));
		  }else{
		    i += 2;
			}
        });
	  $(this).html($(this).html().replace(/\{/g, '<curly>{</curly>'));
      $(this).html($(this).html().replace(/\}/g, '<curly>}</curly>'));
      $(this).html($(this).html().replace(/\:/g, '<colon>:</colon>'));
      $(this).html($(this).html().replace(/"/g, '<quote>"</quote>'));
      $(this).html($(this).html().replace(/\(/g, '<brackets>(</brackets>'));
      $(this).html($(this).html().replace(/\)/g, '<brackets>)</brackets>'));
      $(this).html($(this).html().replace(/tag/g, '<tag>'+'&#60;?php'+'</tag>'));
      $(this).html($(this).html().replace(/sml/g, '<htmltag>'+'&#60;'+'</htmltag>'));
      $(this).html($(this).html().replace(/_ml/g, '<htmltag>'+'&#62;'+'</htmltag>'));
      $(this).html($(this).html().replace(/eml/g, '<htmltag>'+'&#60;/'+'</htmltag>'));
      $(this).html($(this).html().replace(/zml/g, '<htmltag>'+'/&#62;'+'</htmltag>'));
    });
  });
  </script>
</head>
<body>
<img style="position:relative;left:40%;width:150px;height:150px;" src="images/work.svg"/>
  <section class="jumpto">
    <h4>
	<a href="#whatis">what is this?</a><br>
	<a href="#features">features</a><br>
	<a href="#installing">Installing | Downloads</a><br>
	<a href="#hello_world">Hello world!..a simple example</a><br>
	</h4>
  </section>
  <section class="main">
  <h3><a name="whatis">What exactly is this?</a></h3>
  <p>Thalassa is a lightweight implementation of the <a href="http://wamp.ws/">WAMP V2 protocol</a>, written in php.</p>
  <h3><a name="!whatis">!What is</a></h3>
      <p>Thalassa is <i>not</i> a web-socket server.Although it is built upon web-sockets and fully implements the
      web-socket protocol,</br> Thalassa will only work for clients implementing WAMP as a websocket sub-protocol, and hence is
	  better defined as a WAMP</br> server, as opposed to a WAMP-capable websocket server.</p>
  <h3><a name="features">Features</a></h3>
      <p>Thalassa features an event-driven IO using libevent, and implements the role of a router and a dealer.</p>
  <h3><a name="requirements">Requirements</a></h4>
      <p>A working installation of the <a href="http://libevent.org/">libevent library</a> and <a href="http://pecl.php.net/package/libevent">necessary extensions.</a></p>
  <h3><a name="installing">Installing</a></h3>
      <p>Composer:</p>
	  <pre><code>"require": {"nsautomaton/thalassa": "dev-master"}</code></pre>
  <h3><a name="hello_world">Hello world!</a></h3>
      <div class="code">
	  <pre>
tag
namespace wampComponent;
use Thalassa\wampAppInterface;
use Thalassa\Dealer\proceduresInterface;
use Thalassa\Router\channelsInterface;
class wampApp implements wampAppInterface{
    public function onOpen($conn, $sessionKey){}
	
    public function onSubscribe(channelsInterface $channelAccess, $conn, $requestID, $channel)
    {
    $channelAccess->add($conn, $channel, $requestID);
    }
   
    public function onUnsubscribe(channelsInterface $channelAccess, $conn, $channel, $requestID)
    {
    $channelAccess->delete($conn, $channel, $requestID);
    }
   
    public function onPublish(channelsInterface $channelAccess, $conn, array $data, array $options)
    {
    $channelAccess->broadcast($channelAccess, $conn, $data, $options);
    }

    public function onRegister(proceduresInterface $exe, $conn, $call, $requestID, array $options)
    {}
	
    public function onUnregister(proceduresInterface $exe, $conn, $regID, $requestID)
    {}
	
    public function onCall(proceduresInterface $exe, $conn, $call, array $args, array $options)
    {}
	
    public function onError($conn, $details){}
	
    public function onClose($conn){}
}
	  </pre>
	  </div>
      <p>The snippet is a bare minimum of a wamp server.all it does is handle subscriptions and route</br>
         messages between subscribers.</p>
      <p>In your project directory, create a folder "src", if it doesn't exist yet.</p>
      <p>In "src", create a folder "wampComponent."</p>
      <p>Save the code as "wampApp.php". Alternatively, you can save it as whatever_name_you_like,</br>
	  provided the class name matches the file name.This is because we're using
	  <a href="http://www.php-fig.org/psr/psr-0/">psr-0</a> autoloading.</br>
	  Similarly, the folder "wampComponent" could be any name you like, as long as it matches the</br>
	  namespace of the code that resides in it.</p>
      <p>In your composer.json:</p>
	  <div class="code">
<pre>
"autoload": {
    "psr-0": {
	    "wampComponent": "src"
    }
}
</pre>
	  </div>
	  <p>...and now the shell script:</p>
	  <div class="code">
	  <pre>
tag
use Thalassa\Server;
use wampComponent\wampApp;
require dirname(__DIR__) . '/vendor/autoload.php';
    $host = '0.0.0.0';
    $port = 9000;
$app = new wampApp;
$server = new Server($host, $port);
$server->Build($app);
$server->start();
	  </pre>
	  </div>
	  <p>Create a folder "bin" and save the code simply as daemon.php</p>
	  <p>That's all.To start the server simply cd your way to to /bin and type the command:</p>
	  <code>php daemon.php</code>
          <h4>But wait!What about the client-side code?</h4>
	  <p>Thalassa could work with any WAMP V2 client.See a <a href="http://wamp.ws/implementations/">list of clients and other routers</a>
	  For this tutorial <a href="http://autobahn.ws/js/">Autobahn|JS</a> is used.</br>
	  Learn more and view the full <a href="http://autobahn.ws/js/reference.html">Autobahn|JS documentation</a>.
	  <p>
	  <div class="code">
<pre>
smlhtml_ml
smlhead_ml
smlmeta charset='utf-8'_ml
smlscript type="text/javascript" src="path_to_your_autobahn|js_copy"_mlemlscript_ml
smlscript type="text/javascript"_ml
function onevent(message)
{
console.log(message);
};
function send()
{
sess.publish("com.test.app", "Hello World");
};
window.onload = function(){
var connection = new autobahn.Connection({url : 'ws://127.0.0.1:9000'});
	connection.onopen = function(session){
		       window.sess = session;
		       session.subscribe("com.test.app", onevent).then(
		               function(subscription)
					   {
					   console.log("subscription successful");			  
					   },
					   function(error)
					   {
					   console.log("subscription error");				  
					   });
		        console.log('Connection established');
    };
	connection.onclose = function(session){
		       console.log('Connection lost');
    };
	connection.open();
};
emlscript_ml
emlhead_ml
smlbody_ml
smlinput type='button' value="send the message!" onclick='send();'zml
emlbody_ml
emlhtml_ml
</pre>
	  </div>
  </section>
</body>
<footer><p>this project <a href="https://github.com/nsautomaton/thalassa">on github.</a></p></footer>
</html>
